<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Lista de Transações</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Minhas Transações</h1>
    <table border="1" cellpadding="10">
        <tr>
            <th>Descrição</th>
            <th>Valor (R$)</th>
            <th>Data</th>
            <th>Tipo</th>
            <th>Categoria</th>
            <th>Ações</th>
        </tr>
        {% for transacao in transacoes %}
        <tr>
            <td>{{ transacao.descricao }}</td>
            <td>{{ transacao.valor }}</td>
            <td>{{ transacao.data.strftime('%d/%m/%Y') }}</td>
            <td>{{ transacao.tipo }}</td>
            <td>{{ transacao.categoria }}</td>
            <td>
                <a href="/deletar/{{ transacao.id }}" style="color:red">[Excluir]</a>
                <a href="{{ url_for('editar_transacao', id=transacao.id) }}">Editar</a>
            </td>
        </tr>
        {% endfor %}
    </table>
<a href="/cadastrar">Voltar para Home</a>

    <h1>Resumo das suas transações</h1>

        <h2>Distribuição dos Gastos</h2>
        <canvas id="graficoPizza" width="400" height="400"></canvas>

        <h2>Entradas vs Saídas</h2>
        <canvas id="graficoBarras" width="400" height="400"></canvas>

    <script>
        let nomes_gastos = {{ nomes_gastos | tojson | safe }};
        let valores_gastos = {{ valores_gastos | tojson | safe }};
        let nomes_entradas = {{ nomes_entradas | tojson | safe }};
        let valores_entradas = {{ valores_entradas | tojson | safe }};

        console.log("Nomes gastos:", nomesGastos);
        console.log("Valores gastos:", valoresGastos);

         new Chart(document.getElementById('graficoPizza'), {
            type: 'pie', // tipo do gráfico
            data: {
                labels: nomes_gastos, // nomes/descrição dos gastos
                datasets: [{
                    label: 'Gastos',
                    data: valores_gastos, // valores dos gastos
                    backgroundColor: ['#ff4d4d', '#ff944d', '#ffff4d', '#94ff4d', '#4dff4d', '#4dffff', '#4d4dff', '#ff4dff']
                }]
            }
        });

        // ================================
        // GRÁFICO DE BARRAS (ENTRADA VS SAÍDA)
        // ================================
        new Chart(document.getElementById('graficoBarras'), {
            type: 'bar', // tipo do gráfico
            data: {
                labels: ['Entradas', 'Saídas'], // categorias fixas
                datasets: [{
                    label: 'Valor Total',
                    data: [
                        valores_entradas.reduce((a, b) => a + b, 0), // soma entradas
                        valores_gastos.reduce((a, b) => a + b, 0) // soma saídas
                    ],
                    backgroundColor: ['#4CAF50', '#F44336']
                }]
            }
        });
    </script>
</body>
</html>